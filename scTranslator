# scTranslator: https://github.com/TencentAILabHealthcare/scTranslator
# performer: https://github.com/lucidrains/performer-pytorch

conda create -n scTranslator python=3.8.13
pip install scipy==1.9.1 numpy==1.21.5 pandas==1.5.1 scikit-learn==1.1.2 scanpy==1.9.1 torch==1.12.1  # numba 0.58.1 requires numpy<1.27, >=1.22 (1.24.4)
pip install matplotlib==3.6.3  # import scanpy bug: TypeError: metaclass conflict: the metaclass of a derived class must be a (non-strict) subclass of the metaclasses of all its bases
pip install einops local_attention
wget -c https://codeload.github.com/TencentAILabHealthcare/scTranslator/zip/refs/heads/main

scp -P 6122 GSM2685244_protein_3_PBMCs_matrix_mapped.h5ad GSM2685244_mRNA_3_PBMCs_matrix_mapped.h5ad jiluzhang@10.11.41.108:/fs/home/jiluzhang/scTranslator/dataset/test/dataset2
scp -P 6122 stage2_single-cell_scTranslator.pt jiluzhang@10.11.41.108:/fs/home/jiluzhang/scTranslator/checkpoint

python code/stage3_inference_without_finetune.py \
--pretrain_checkpoint='checkpoint/stage2_single-cell_scTranslator.pt' \
--RNA_path='dataset/test/dataset2/GSM2685244_mRNA_3_PBMCs_matrix_mapped.h5ad' \
--Pro_path='dataset/test/dataset2/GSM2685244_protein_3_PBMCs_matrix_mapped.h5ad'

#RuntimeError: CUDA error: no kernel image is available for execution on the device
#CUDA kernel errors might be asynchronously reported at some other API call,so the stacktrace below might be incorrect.
#For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
